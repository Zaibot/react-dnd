(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{1117:function(n,e,t){"use strict";t.r(e),function(n){var e=t(0),r=t.n(e),i=t(218),o=t(32),a=t(221),s=t(91),g=t(220),d=t(219),p=t(571),l=t(570),c=t(569),f=t(136).withStorySource;const u=({innerRef:n,...e})=>r.a.createElement("div",Object.assign({},e,{ref:n,style:{...e.style,background:"#fcc",display:"inline-block",padding:"2rem"}})),D=({innerRef:n,...e})=>r.a.createElement("div",Object.assign({},e,{ref:n,style:{...e.style,background:"#aaf",display:"inline-block",padding:"2rem",opacity:.75}})),h=({innerRef:n,...e})=>r.a.createElement("div",Object.assign({},e,{ref:n,style:{...e.style,background:"#ffa",display:"inline-block",padding:"2rem"}})),m=[{id:1,text:"Hello"},{id:2,text:"World"},{id:3,text:"!"}];Object(i.storiesOf)("react-dnd",n).addDecorator(f("import React from 'react';\nimport { storiesOf } from '@storybook/react';\nimport { action } from '@storybook/addon-actions';\nimport { Droppable } from '../src/droppable';\nimport { DraggingProvider } from '../src/dragging-provider';\nimport { Draggable } from '../src/draggable';\nimport { DragHandle } from '../src/drag-handle';\nimport { PositionContainer } from '../src/position-container';\nimport { PositionPublisher } from '../src/position-publisher';\nimport { closestCorner } from '../src/strategy-closest-corner';\n\nconst stories = storiesOf('react-dnd', module);\n\nconst Red = ({ innerRef, ...props }: React.HTMLProps<HTMLDivElement> & { innerRef: any }) => (\n  <div\n    {...props}\n    ref={innerRef}\n    style={{ ...props.style, background: `#fcc`, display: `inline-block`, padding: `2rem` }}\n  />\n);\nconst Blue = ({ innerRef, ...props }: React.HTMLProps<HTMLDivElement> & { innerRef: any }) => (\n  <div\n    {...props}\n    ref={innerRef}\n    style={{ ...props.style, background: `#aaf`, display: `inline-block`, padding: `2rem`, opacity: 3 / 4 }}\n  />\n);\nconst Yellow = ({ innerRef, ...props }: React.HTMLProps<HTMLDivElement> & { innerRef: any }) => (\n  <div\n    {...props}\n    ref={innerRef}\n    style={{ ...props.style, background: `#ffa`, display: `inline-block`, padding: `2rem` }}\n  />\n);\n\nconst orderingData = [{ id: 1, text: `Hello` }, { id: 2, text: `World` }, { id: 3, text: `!` }];\n\nstories\n  .add(`Basic`, () => (\n    <DraggingProvider>\n      <Droppable onDropped={action(`onDropped`)} onDropping={undefined}>\n        {({ isDropping, dropProps, trackingProps }) => (\n          <Red {...trackingProps} {...dropProps} innerRef={trackingProps.ref}>\n            {isDropping ? 'Dropping!' : 'Waiting...'}\n          </Red>\n        )}\n      </Droppable>\n      <Draggable\n        dataDrag={1}\n        onDragEnd={action(`onDragEnd`)}\n        onDragMove={undefined}\n        onDragStart={action(`onDragStart`)}\n      >\n        {({ isDragging, isDragged, dragContainerProps, dragHandleProps, trackingProps: { ref }, dragging }) =>\n          isDragged ? (\n            <Blue {...dragContainerProps} {...dragHandleProps} innerRef={ref}>\n              Being dragged\n            </Blue>\n          ) : isDragging ? (\n            <Yellow {...dragContainerProps} {...dragHandleProps} innerRef={ref}>\n              {dragging}Dragging me\n            </Yellow>\n          ) : (\n            <Yellow {...dragContainerProps} {...dragHandleProps} innerRef={ref}>\n              {dragging}Drag me\n            </Yellow>\n          )\n        }\n      </Draggable>\n    </DraggingProvider>\n  ))\n  .add(`Handle`, () => (\n    <DraggingProvider>\n      <Droppable onDropped={action(`onDropped`)} onDropping={undefined}>\n        {({ isDropping, dropProps, trackingProps }) => (\n          <Red {...trackingProps} {...dropProps} innerRef={trackingProps.ref}>\n            {isDropping ? 'Dropping!' : 'Waiting...'}\n          </Red>\n        )}\n      </Droppable>\n      <Draggable\n        dataDrag={1}\n        onDragEnd={action(`onDragEnd`)}\n        onDragMove={undefined}\n        onDragStart={action(`onDragStart`)}\n      >\n        {({ isDragging, isDragged, dragContainerProps, dragHandleProps, trackingProps: { ref }, dragging }) =>\n          isDragged ? (\n            <Blue {...dragContainerProps} innerRef={ref}>\n              <DragHandle dragHandleProps={dragHandleProps}>Handle</DragHandle> Being dragged\n            </Blue>\n          ) : isDragging ? (\n            <Yellow {...dragContainerProps} innerRef={ref}>\n              {dragging}\n              <DragHandle dragHandleProps={dragHandleProps}>Handle</DragHandle> Dragging me\n            </Yellow>\n          ) : (\n            <Yellow {...dragContainerProps} innerRef={ref}>\n              {dragging}\n              <DragHandle dragHandleProps={dragHandleProps}>Handle</DragHandle> Drag me\n            </Yellow>\n          )\n        }\n      </Draggable>\n    </DraggingProvider>\n  ))\n  .add(`Ordering`, () => (\n    <DraggingProvider>\n      <PositionContainer>\n        {({ refContainer, registries }) => (\n          <Droppable onDropped={action(`onDropped`)} onDropping={undefined} refTracking={refContainer}>\n            {({ isDropping, dropProps, trackingProps, droppingPosition }) => (\n              <Red {...trackingProps} {...dropProps} innerRef={trackingProps.ref}>\n                {orderingData.map(item => (\n                  <PositionPublisher keyData={item}>\n                    {({ refContainer }) => (\n                      <Draggable\n                        dataDrag={item}\n                        onDragEnd={action(`onDragEnd`)}\n                        onDragMove={undefined}\n                        onDragStart={action(`onDragStart`)}\n                        refTracking={refContainer}\n                      >\n                        {({ isDragged, dragContainerProps, dragHandleProps, trackingProps, dragging }) =>\n                          isDragged ? (\n                            <Blue {...dragContainerProps} {...dragHandleProps} innerRef={trackingProps.ref}>\n                              {dragging}\n                              {item.text}\n                            </Blue>\n                          ) : (\n                            <Yellow {...dragContainerProps} {...dragHandleProps} innerRef={trackingProps.ref}>\n                              {dragging}\n                              {item.text}\n                            </Yellow>\n                          )\n                        }\n                      </Draggable>\n                    )}\n                  </PositionPublisher>\n                ))}\n\n                <ol>\n                  {registries.map(({ getBounds, key }) => (\n                    <li>\n                      {key.text} ({getBounds().left}:{getBounds().top}, {getBounds().width}w{getBounds().height}h)\n                    </li>\n                  ))}\n                </ol>\n                <p style={{ whiteSpace: 'pre' }}>\n                  {isDropping ? (\n                    <span>\n                      Dropping:{' '}\n                      {(() => {\n                        const elements = registries.map(({ getBounds, key }) => ({\n                          bounds: getBounds(),\n                          key,\n                          order: orderingData.indexOf(key),\n                        }));\n                        const closest = closestCorner.horizontal(droppingPosition, elements);\n                        return (\n                          <span>\n                            {closest.isBefore ? 'Before' : 'After'} {closest.element.key.text}\n                          </span>\n                        );\n                      })()}\n                    </span>\n                  ) : (\n                    `Drag something`\n                  )}\n                </p>\n              </Red>\n            )}\n          </Droppable>\n        )}\n      </PositionContainer>\n    </DraggingProvider>\n  ));\n",{})).add("Basic",()=>r.a.createElement(s.a,null,r.a.createElement(a.a,{onDropped:Object(o.action)("onDropped"),onDropping:void 0},({isDropping:n,dropProps:e,trackingProps:t})=>r.a.createElement(u,Object.assign({},t,e,{innerRef:t.ref}),n?"Dropping!":"Waiting...")),r.a.createElement(g.a,{dataDrag:1,onDragEnd:Object(o.action)("onDragEnd"),onDragMove:void 0,onDragStart:Object(o.action)("onDragStart")},({isDragging:n,isDragged:e,dragContainerProps:t,dragHandleProps:i,trackingProps:{ref:o},dragging:a})=>e?r.a.createElement(D,Object.assign({},t,i,{innerRef:o}),"Being dragged"):n?r.a.createElement(h,Object.assign({},t,i,{innerRef:o}),a,"Dragging me"):r.a.createElement(h,Object.assign({},t,i,{innerRef:o}),a,"Drag me")))).add("Handle",()=>r.a.createElement(s.a,null,r.a.createElement(a.a,{onDropped:Object(o.action)("onDropped"),onDropping:void 0},({isDropping:n,dropProps:e,trackingProps:t})=>r.a.createElement(u,Object.assign({},t,e,{innerRef:t.ref}),n?"Dropping!":"Waiting...")),r.a.createElement(g.a,{dataDrag:1,onDragEnd:Object(o.action)("onDragEnd"),onDragMove:void 0,onDragStart:Object(o.action)("onDragStart")},({isDragging:n,isDragged:e,dragContainerProps:t,dragHandleProps:i,trackingProps:{ref:o},dragging:a})=>e?r.a.createElement(D,Object.assign({},t,{innerRef:o}),r.a.createElement(d.a,{dragHandleProps:i},"Handle")," Being dragged"):n?r.a.createElement(h,Object.assign({},t,{innerRef:o}),a,r.a.createElement(d.a,{dragHandleProps:i},"Handle")," Dragging me"):r.a.createElement(h,Object.assign({},t,{innerRef:o}),a,r.a.createElement(d.a,{dragHandleProps:i},"Handle")," Drag me")))).add("Ordering",()=>r.a.createElement(s.a,null,r.a.createElement(p.a,null,({refContainer:n,registries:e})=>r.a.createElement(a.a,{onDropped:Object(o.action)("onDropped"),onDropping:void 0,refTracking:n},({isDropping:n,dropProps:t,trackingProps:i,droppingPosition:a})=>r.a.createElement(u,Object.assign({},i,t,{innerRef:i.ref}),m.map(n=>r.a.createElement(l.a,{keyData:n},({refContainer:e})=>r.a.createElement(g.a,{dataDrag:n,onDragEnd:Object(o.action)("onDragEnd"),onDragMove:void 0,onDragStart:Object(o.action)("onDragStart"),refTracking:e},({isDragged:e,dragContainerProps:t,dragHandleProps:i,trackingProps:o,dragging:a})=>e?r.a.createElement(D,Object.assign({},t,i,{innerRef:o.ref}),a,n.text):r.a.createElement(h,Object.assign({},t,i,{innerRef:o.ref}),a,n.text)))),r.a.createElement("ol",null,e.map(({getBounds:n,key:e})=>r.a.createElement("li",null,e.text," (",n().left,":",n().top,", ",n().width,"w",n().height,"h)"))),r.a.createElement("p",{style:{whiteSpace:"pre"}},n?r.a.createElement("span",null,"Dropping: ",(()=>{const n=e.map(({getBounds:n,key:e})=>({bounds:n(),key:e,order:m.indexOf(e)})),t=c.a.horizontal(a,n);return r.a.createElement("span",null,t.isBefore?"Before":"After"," ",t.element.key.text)})()):"Drag something"))))))}.call(this,t(388)(n))},1118:function(n,e,t){var r={"./index.tsx":1117};function i(n){var e=o(n);return t(e)}function o(n){var e=r[n];if(!(e+1)){var t=new Error("Cannot find module '"+n+"'");throw t.code="MODULE_NOT_FOUND",t}return e}i.keys=function(){return Object.keys(r)},i.resolve=o,n.exports=i,i.id=1118},1137:function(n,e,t){"use strict";t.r(e),function(n){var e=t(218),r=t(1118);Object(e.configure)(function(){r.keys().forEach(function(n){return r(n)})},n)}.call(this,t(388)(n))},1139:function(n,e,t){t(486),t(1138),n.exports=t(1137)},140:function(n,e,t){"use strict";var r=t(560);t.o(r,"emptyBounds")&&t.d(e,"emptyBounds",function(){return r.emptyBounds}),t.o(r,"isPositionSame")&&t.d(e,"isPositionSame",function(){return r.isPositionSame});var i=t(559);t.o(i,"emptyBounds")&&t.d(e,"emptyBounds",function(){return i.emptyBounds}),t.o(i,"isPositionSame")&&t.d(e,"isPositionSame",function(){return i.isPositionSame});var o=t(558);t.d(e,"emptyBounds",function(){return o.a});var a=t(557);t.d(e,"isPositionSame",function(){return a.a});t(556)},217:function(n,e,t){"use strict";t.d(e,"a",function(){return i}),t.d(e,"b",function(){return o});var r=t(0);const{Consumer:i,Provider:o}=r.createContext({reportRefContainer(){console.warn("[@zaibot/react-dnd] missing PositionContainer")},getPosition:()=>(console.warn("[@zaibot/react-dnd] missing PositionContainer"),null),getPositions:()=>(console.warn("[@zaibot/react-dnd] missing PositionContainer"),[])})},219:function(n,e,t){"use strict";t.d(e,"a",function(){return o});var r=t(0),i=t.n(r);class o extends i.a.Component{render(){const{dragHandleProps:n,children:e}=this.props;return i.a.createElement("div",Object.assign({style:{display:"inline"}},n),e)}}},220:function(n,e,t){"use strict";(function(n){t.d(e,"a",function(){return g});var r=t(0),i=t.n(r),o=t(91),a=t(140);let s;const g=Object(o.b)(class extends i.a.Component{constructor(n,e){super(n,e),this.state={isDragging:!1,element:null,offsetWithinElement:null,offsetWithinViewport:null},this.getBounds=this.getBounds.bind(this),this.onRefTracking=this.onRefTracking.bind(this),this.onDragStart=this.onDragStart.bind(this),this.onDrag=this.onDrag.bind(this),this.onDragEnd=this.onDragEnd.bind(this)}render(){return this.renderStatic()}renderStatic(){const{isDragging:n}=this.state,e=this.getBounds(),t=this.state.offsetWithinElement,r={draggable:!0,onDragStart:this.onDragStart,onDrag:this.onDrag,onDragEnd:this.onDragEnd},i={ref:this.onRefTracking},o=n?this.renderDragging():null;return this.props.children({dragHandleProps:r,dragContainerProps:{},trackingProps:i,isDragging:n,isDragged:!1,dragging:o,bounds:e,touchPosition:t})}renderDragging(){const{offsetWithinViewport:n}=this.state,e=this.getBounds();if(!e)return void console.warn("[@zaibot/react-dnd] missing static bounds");if(!n)return void console.warn("[@zaibot/react-dnd] missing dragging offsets");const t=this.state.offsetWithinElement,r={style:{pointerEvents:"none",transform:`translate(${n.left}px, ${n.top}px)`,position:"fixed",boxSizing:"border-box",top:"0",left:"0",width:`${e.width}px`,height:`${e.height}px`,zIndex:999999}};return this.props.children({dragHandleProps:{},dragContainerProps:r,trackingProps:{},isDragging:!0,isDragged:!0,dragging:null,bounds:e,touchPosition:t})}onRefTracking(n){this.state.element!==n&&(this.setState({element:n}),this.props.refTracking&&this.props.refTracking(n))}getBounds(){return this.state.element?this.state.element.getBoundingClientRect():null}onDragStart(e){const t=this.getBounds();if(!t)return void console.warn("[@zaibot/react-dnd] missing static bounds");e.dataTransfer.setDragImage((s||((s=new Image).src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="),s),0,0),e.dataTransfer.effectAllowed="move";const r={left:e.clientX-t.left,top:e.clientY-t.top},i={left:e.clientX-r.left,top:e.clientY-r.top};n(()=>{this.setState({isDragging:!0,offsetWithinElement:r,offsetWithinViewport:i}),this.props.onDragging(this.props.dataDrag)}),e.stopPropagation()}onDrag(n){const{offsetWithinElement:e}=this.state;if(!e)return;const t={left:n.clientX-this.state.offsetWithinElement.left,top:n.clientY-this.state.offsetWithinElement.top};Object(a.isPositionSame)(t,this.state.offsetWithinViewport)||this.setState({offsetWithinViewport:t}),n.stopPropagation()}onDragEnd(n){this.setState({isDragging:!1}),this.props.onDragged(),n.stopPropagation()}})}).call(this,t(1116).setImmediate)},221:function(n,e,t){"use strict";t.d(e,"a",function(){return a});var r=t(0),i=t(91),o=t(140);const a=Object(i.b)(class extends r.Component{constructor(n,e){super(n,e),this.state={droppingData:null,droppingPosition:null},this.dropProps={onDrop:this.onDrop.bind(this),onDragOver:this.onDragOver.bind(this),onDragLeave:this.onDragLeave.bind(this)}}render(){const{droppingData:n,droppingPosition:e}=this.state,t=!!this.state.droppingData,r=this.dropProps,i={ref:this.props.refTracking};return this.props.children({dropProps:r,trackingProps:i,isDropping:t,droppingData:n,droppingPosition:e})}onDragOver(n){const e=this.props.draggingData,t={left:n.clientX,top:n.clientY};this.state.droppingData===e&&Object(o.isPositionSame)(this.state.droppingPosition,t)||(this.setState({droppingData:e,droppingPosition:t}),this.props.onDropping&&this.props.onDropping({droppingPosition:t,droppingData:e})),n.preventDefault()}onDragLeave(n){this.setState({droppingData:null,droppingPosition:null}),n.preventDefault()}onDrop(n){const e=this.props.draggingData,t={left:n.clientX,top:n.clientY};this.setState({droppingData:null,droppingPosition:null}),this.props.onDropped&&this.props.onDropped({droppingPosition:t,droppingData:e}),n.preventDefault()}})},556:function(n,e){},557:function(n,e,t){"use strict";t.d(e,"a",function(){return r});const r=(n,e)=>n===e||n&&e&&n.left===e.left&&n.top===e.top},558:function(n,e,t){"use strict";t.d(e,"a",function(){return r});const r={left:0,top:0,right:0,bottom:0,width:0,height:0}},559:function(n,e){},560:function(n,e){},569:function(n,e,t){"use strict";t.d(e,"a",function(){return i});const r=(n,e,t,r,i,o)=>{const a=i-t,s=o-r,g=a*a+s*s,d=0!==g?((n-t)*a+(e-r)*s)/g:-1;let p=0,l=0;d<0?(p=t,l=r):d>1?(p=i,l=o):(p=t+d*a,l=r+d*s);const c=n-p,f=e-l;return Math.sqrt(c*c+f*f)},i={vertical:(n,e)=>{const t=e.reduce((e,t)=>{const i=((n,e)=>r(n.left,n.top,e.left,e.top,e.right,e.top))(n,t.bounds);return!e||i<e.distance?{element:t,distance:i,isBefore:!0,isAfter:!1}:e},null);return e.reduce((e,t)=>{const i=((n,e)=>r(n.left,n.top,e.left,e.bottom-1,e.right,e.bottom-1))(n,t.bounds);return!e||i<e.distance?{element:t,distance:i,isBefore:!1,isAfter:!0}:e},t)||null},horizontal:(n,e)=>{const t=e.reduce((e,t)=>{const i=((n,e)=>r(n.left,n.top,e.left,e.top,e.left,e.bottom))(n,t.bounds);return!e||i<e.distance?{element:t,distance:i,isBefore:!0,isAfter:!1}:e},null);return e.reduce((e,t)=>{const i=((n,e)=>r(n.left,n.top,e.right-1,e.top,e.right-1,e.bottom))(n,t.bounds);return!e||i<e.distance?{element:t,distance:i,isBefore:!1,isAfter:!0}:e},t)||null}}},570:function(n,e,t){"use strict";t.d(e,"a",function(){return g});var r=t(0),i=t.n(r),o=t(217),a=t(140);class s extends i.a.Component{constructor(n,e){super(n,e),this.onRefContainer=this.onRefContainer.bind(this),this.getBounds=this.getBounds.bind(this)}render(){const{children:n}=this.props;return n({refContainer:this.onRefContainer})}onRefContainer(n){this.__element!==n&&(this.__element=n,this.props.reportRefContainer(this.props.keyData,n?this.getBounds:null),this.props.refContainer&&this.props.refContainer(n))}getBounds(){return this.__element?this.__element.getBoundingClientRect():a.emptyBounds}}const g=({children:n,refContainer:e,...t})=>i.a.createElement(o.a,null,({reportRefContainer:e})=>i.a.createElement(s,Object.assign({},t,{reportRefContainer:e}),n))},571:function(n,e,t){"use strict";t.d(e,"a",function(){return a});var r=t(0),i=t.n(r),o=t(217);class a extends i.a.Component{constructor(n,e){super(n,e),this.__registries=[],this.state={registries:this.__registries,element:null},this.reportRefContainer=this.reportRefContainer.bind(this),this.getPositions=this.getPositions.bind(this),this.getPosition=this.getPosition.bind(this),this.onContainerRef=this.onContainerRef.bind(this),this.getBounds=this.getBounds.bind(this)}render(){const n=this.getBounds,e=this.onContainerRef,t=this.state.registries,r=this.props.children({refContainer:e,getBounds:n,registries:t});return i.a.createElement(o.b,{value:this},r)}reportRefContainer(n,e){if(e){if(this.__registries.find(({key:t,getBounds:r})=>n===t&&e===r))return;const t={key:n,getBounds:e},r=[...this.__registries.filter(e=>e.key!==n),t];this.setState({registries:this.__registries=r})}else{if(!this.__registries.find(({key:e})=>n===e))return;const e=this.__registries.filter(e=>e.key!==n);this.setState({registries:this.__registries=e})}}getPositions(){return this.__registries.map(({key:n,getBounds:e})=>({key:n,bounds:e()}))}getPosition(n){const e=this.__registries.find(({key:e})=>n===e);return e?e.getBounds():null}onContainerRef(n){this.state.element!==n&&this.setState({element:n})}getBounds(){return this.state.element?this.state.element.getBoundingClientRect():null}}},91:function(n,e,t){"use strict";t.d(e,"a",function(){return o}),t.d(e,"b",function(){return a});var r=t(0);const i=r.createContext({draggingData:null,onDragging(){console.warn("[@zaibot/react-dnd] missing DraggingProvider")},onDragged(){console.warn("[@zaibot/react-dnd] missing DraggingProvider")}});class o extends r.Component{constructor(n,e){super(n,e),this.onDragging=this.onDragging.bind(this),this.onDragged=this.onDragged.bind(this),this.state={draggingData:null,onDragging:this.onDragging,onDragged:this.onDragged}}render(){return r.createElement(i.Provider,{value:this.state},this.props.children)}onDragging(n){this.setState({draggingData:n})}onDragged(){this.setState({draggingData:null})}}const a=n=>{return r.forwardRef((e,t)=>r.createElement(i.Consumer,null,({draggingData:i,onDragged:o,onDragging:a})=>r.createElement(n,Object.assign({},e,{onDragging:a,onDragged:o,draggingData:i,ref:t}))))}}},[[1139,1,2]]]);
//# sourceMappingURL=preview.4aece1460cdfe4a2d0f0.bundle.js.map